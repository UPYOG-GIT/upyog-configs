ReportDefinitions:
- reportName: bpaApplicationStatusReport
  decryptionPathId: bpaApplicationStatusReport
  summary: bpa Application Status Report
  version: 1.0.0
  moduleName: rainmaker-bpa
  sourceColumns:
    - name: applicationno
      label: reports.bpa.applicationno
      type: string
      source: bpa
    - name: applicationdate
      label: reports.bpa.applicationdate
      type: string
      source: bpa
    - name: applicationchannel
      label: reports.bpa.applicationchannel
      type: string
      source: bpa
    - name: uuid
      label: reports.bpa.uuid
      type: string
      source: bpa
      showColumn: false
    - name: name
      label: reports.bpa.name
      type: string
      source: bpa
    - name: applicationtype
      label: reports.bpa.applicationtype
      type: string
      source: bpa
    - name: servicetype
      label: reports.bpa.servicetype
      type: string
      source: bpa
    - name: occupancytype
      label: reports.bpa.occupancytype
      type: string
      source: bpa
    - name: status
      label: reports.bpa.status
      type: string
      source: bpa
    - name: currentowner
      label: reports.bpa.currentowner
      type: string
      source: bpa
  searchParams:
    - name: fromDate
      label: FromDate
      type: epoch
      source: bpa
      isMandatory: false
      searchClause: AND bp.createdtime >= $fromDate
    - name: toDate
      label: ToDate
      type: epoch
      source: bpa
      isMandatory: false
      searchClause: AND bp.createdtime  <= $toDate
    - name: applicationChannel
      label: reports.bpa.applicationchannel
      type: multivaluelist
      source: bpa
      isMandatory: false
      searchClause: AND landinfo.channel in ( $applicationChannel )
      pattern: 'list://SYSTEM:SYSTEM'
      isLocalisationRequired: true
      localisationPrefix: REPORT_bpa_
    - name: applicationType
      label: reports.bpa.applicationtype
      type: multivaluelist
      source: bpa
      isMandatory: false
      pattern: 'list://BUILDING_OC_PLAN_SCRUTINY:BUILDING_OC_PLAN_SCRUTINY,BUILDING_PLAN_SCRUTINY:BUILDING_PLAN_SCRUTINY'
      searchClause: AND bp.additionaldetails->>'applicationType' in ( $applicationType )
      isLocalisationRequired: true
      localisationPrefix: REPORT_bpa_
    - name: serviceType
      label: reports.bpa.servicetype
      type: multivaluelist
      source: bpa
      isMandatory: false
      pattern: 'list://NEW_CONSTRUCTION:NEW_CONSTRUCTION'
      searchClause: AND bp.additionaldetails->> 'serviceType' in ( $serviceType )
      isLocalisationRequired: true
      localisationPrefix: REPORT_bpa_
    - name: status
      label: reports.bpa.status
      type: multivaluelist
      source: bpa
      isMandatory: false
      pattern: 'list://CITIZEN_ACTION_PENDING_AT_DOC_VERIF:CITIZEN_ACTION_PENDING_AT_DOC_VERIF,INPROGRESS:INPROGRESS,PENDING_APPL_FEE:PENDING_APPL_FEE,PENDING_SANC_FEE_PAYMENT:PENDING_SANC_FEE_PAYMENT,DOC_VERIFICATION_INPROGRESS:DOC_VERIFICATION_INPROGRESS,CITIZEN_ACTION_PENDING_AT_NOC_VERIF:CITIZEN_ACTION_PENDING_AT_NOC_VERIF,PERMIT REVOCATION:PERMIT REVOCATION,FIELDINSPECTION_INPROGRESS:FIELDINSPECTION_INPROGRESS,PENDING_FEE:PENDING_FEE,NOC_VERIFICATION_INPROGRESS:NOC_VERIFICATION_INPROGRESS,INITIATED:INITIATED,CITIZEN_APPROVAL_INPROCESS:CITIZEN_APPROVAL_INPROCESS,REJECTED:REJECTED,APPROVED:APPROVED,CITIZEN_ACTION_PENDING_AT_FI_VERIF:CITIZEN_ACTION_PENDING_AT_FI_VERIF,APPROVAL_INPROGRESS:APPROVAL_INPROGRESS'
      searchClause: AND bp.status in ( $status )
      isLocalisationRequired: true
      localisationPrefix: REPORT_bpa_

  query: select applicationno,to_char(To_timestamp(bp.createdtime / 1000), 'DD/MM/YYYY') as applicationdate, landinfo.channel as applicationchannel, usr.name as name,  usr.uuid as uuid, bp.additionaldetails->>'applicationType' as applicationtype, bp.additionaldetails->> 'serviceType' as servicetype, land.occupancytype, bp.status, case when isterminatestate=true then null else userassignee.name end as currentowner, bp.approvalno as permitno FROM eg_wf_state_v2 st inner join eg_wf_processinstance_v2 pi on pi.status=st.uuid inner join eg_bpa_buildingplan bp on pi.businessid=bp.applicationno inner join eg_user usr ON bp.createdby = usr.uuid  inner join eg_land_unit land ON land.landinfoid = bp.landid inner join eg_land_landinfo landinfo ON land.landinfoid = landinfo.id inner join eg_land_address adr ON adr.landinfoid = landinfo.id inner join eg_user userassignee ON assigner = userassignee.uuid WHERE 1=1
  orderby: ORDER BY bp.createdtime asc 
 
    
    
- reportName: MisPendencyReport
  summary: fetch pending applications
  version: 1.0.0
  moduleName: rainmaker-obps
  sourceColumns:
    - name: Pending_by_subengineer
      label: reports.obps.Pending_by_subengineer
      type: string
      source: obps
    - name: Pending_by_Builder
      label: reports.obps.Pending_by_Builder
      type: string
      source: obps
    - name: Pending_by_commissioner
      label: reports.obps.Pending_by_commissioner
      type: string
      source: obps
    - name: Pending_by_architect
      label: reports.obps.Pending_by_architect
      type: string
      source: obps
      showColumn: false
    - name: Total_pending_cases
      label: reports.obps.Total_pending_cases
      type: string
      source: obps
  searchParams:
    - name: fromDate
      label: FromDate
      type: epoch
      source: obps
      isMandatory: false
      searchClause: AND 1=1
    - name: toDate
      label: ToDate
      type: epoch
      source: obps
      isMandatory: false
      searchClause: AND 1=1
    - name: ulb
      label: ULB
      type: singlevaluelist
      source: obps
      isMandatory: false
      searchClause: AND 1=1
      pattern: http://egov-mdms-service:8080/egov-mdms-service/v1/_get?tenantId=$tenantid&moduleName=tenant&masterName=tenants|$.MdmsRes.tenant.tenants.*.code|$.MdmsRes.tenant.tenants.*.name
      isLocalisationRequired: true
      localisationPrefix: REPORT_OBPS_

  query: select Pending_by_subengineer,  Pending_by_Builder, Pending_by_commissioner, Pending_by_architect, (Pending_by_subengineer + Pending_by_Builder + Pending_by_commissioner + Pending_by_architect ) as Total_pending_cases from (
        SELECT
      COUNT(CASE WHEN status = 'doc_verification_pending_by_engineer' THEN 1 END) AS Pending_by_subengineer,
      COUNT(CASE WHEN status = 'doc_verification_inprogress_by_engineer' THEN 1 END) AS Pending_by_Builder,
      COUNT(CASE WHEN status = 'pendingapproval' THEN 1 END) AS Pending_by_commissioner,
      COUNT(CASE WHEN status = 'PENDING_APPL_FEE' THEN 1 END) AS Pending_by_architect
      FROM  eg_bpa_buildingplan WHERE applicationdate >= $fromDate) as t WHERE 1=1
 
